<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Hello World</title>
    <script type="text/javascript" src="https://unpkg.com/react@16/umd/react.development.js"></script>
    <script type="text/javascript" src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
    <script type="text/javascript" src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const ShoppingList = {
        list: [],
        add: (item, price) => {
          ShoppingList.list.push({
            'item':item,
            'price': price,
          });
        },
        rem: idx => {
          ShoppingList.list = ShoppingList.list.filter((item, currIdx) => {
            return (currIdx !== idx);
          })
        }
      }

      // const render = () => {
      //   const root = document.getElementById('root');
      //   let str = '';
      //   for (let i = 0; i < ShoppingList.list.length; i++) {
      //     str += `<li data-idx="${i}">${ShoppingList.list[i].item}</li>`
      //   }
      //   root.innerHTML = `<ul>${str}</ul>`
      // }

      // document.getElementById('root').addEventListener('click', e => {
      //   if (e.target.matches('li')) {
      //     const idx = e.target.getAttribute('data-idx');
      //     ShoppingList.rem(idx);
      //     render();
      //   }
      // })

      ShoppingList.add('a', 1.00)
      ShoppingList.add('b', 2.50)
      ShoppingList.add('c', 3.14)
      // render();

      class ShoppingListUIItem extends React.Component {
        constructor(props) {
          super(props)
          this.state = {
            editMode: false,
          }
        }

        toggleEditMode() {
          const currentEditMode = this.state.editMode;

          this.setState({
            editMode: !currentEditMode
          })
        }

        render() {
          const itemStyle = {
            padding: '10px',
            fontSize: '10px',
            fontWeight: 'bolder',
          }
          if (this.state.editMode === true) {
            return <li>
              <input type="text" placeholder={this.props.item} />
              <button>Update</button>
              <button onClick={e => this.setState({editMode: false})}>Cancel</button>
            </li>
          }


          return <li onClick={e => this.toggleEditMode()}>
            {this.props.item}
            <span style={itemStyle} onClick={e => this.props.onMutate('LIST_REMOVE', this.props.idx)}>X</span>
          </li>
        }
      }

      class ShoppingListUI extends React.Component {
        render() {
          const shoppingListItems = [];
          for (let i = 0; i < this.props.myShoppingItems.length; i++) {
            shoppingListItems.push(
              <ShoppingListUIItem {...this.props} 
                key={i}
                idx={i} 
                item={this.props.myShoppingItems[i].item} />
            );
          }
          return <div>
            <input type="text" ref="foobar" />
            <button onClick={e => this.props.onMutate('LIST_ADD', this.refs.foobar.value)}>
              Add Item
            </button>
            <ul>{shoppingListItems}</ul>
          </div>
        }
      }

      const onMutate = (typeOfMutation, i) => {
        console.log(typeOfMutation, i)
        console.log(i)
        if (typeOfMutation === 'LIST_REMOVE') {
          ShoppingList.rem(i);
        }
        else if (typeOfMutation === "LIST_ADD") {
          ShoppingList.add(i);
        }

        render();
      }

      const render = () => {
          ReactDOM.render(
          <ShoppingListUI 
            foo="bar"
            myShoppingItems={ShoppingList.list}
            onMutate={onMutate} />,
          document.getElementById('root')
        );
      }

      render();

      // let i = 0;
      // const k = setInterval(() => {
      //   ShoppingList.add(Math.floor(Math.random()*1000)+'a');
      //   render();
      //   console.log(i)
      //   i++;

      //   if (i === 600) clearInterval(k);
      // }, 1000)

    </script>
  </body>
</html>